# BookingService - Test Plan

## Цель тестирования

Проверить корректность работы всех endpoints BookingService согласно OpenAPI спецификации с учётом:
- Поддержки множественных адресов компании
- Иерархической конфигурации слотов (service@address > address > service > global)
- Параллельных бронирований (maxConcurrentBookings)
- Валидации ограничений (advanceBookingDays, minBookingNoticeMinutes)
- Денормализации данных из других сервисов
- Обработки граничных случаев и ошибок

---

## Предусловия

### 1. Запущенные сервисы

Все сервисы должны быть доступны:
- **BookingService**: http://localhost:8083
- **UserService**: http://localhost:8080
- **SellerService**: http://localhost:8081
- **PostgreSQL**: localhost:5438

### 2. Тестовые данные

#### В UserService должны существовать:
- Пользователь `123456789` с выбранным автомобилем (BMW X5, А123БВ799)
- Пользователь `987654321` с выбранным автомобилем (Mercedes E-Class, В999КС777)
- Пользователь `111222333` с выбранным автомобилем (Audi A4, С555АА199)
- Пользователь `999999999` без выбранного автомобиля (для негативного теста)

#### В SellerService должны существовать:
- **Компания 1** "Автомойка Премиум"
  - Адрес 100: Москва, ул. Тверская, 10
  - Адрес 101: Москва, ул. Ленина, 5
  - Услуга 1: "Комплексная мойка" (60 мин, 1500₽) - доступна на обоих адресах
  - Услуга 2: "Экспресс-мойка" (30 мин, 800₽) - доступна только на адресе 100
  - Услуга 3: "Детейлинг" (120 мин, 5000₽) - доступна только на адресе 101
  - Рабочие часы: Пн-Пт 09:00-21:00, Сб 10:00-20:00, Вс выходной
  - Менеджер: `777777777`

- **Компания 2** "СТО Профи"
  - Адрес 200: Москва, ул. Новая, 15
  - Услуга 10: "Замена масла" (45 мин, 2000₽)
  - Рабочие часы: Круглосуточно
  - Менеджер: `888888888`

- **Компания 3** "Детейлинг Центр"
  - Адрес 300: Санкт-Петербург, Невский пр., 1
  - Услуга 20: "Полировка кузова" (180 мин, 8000₽)
  - Рабочие часы: Пн-Вс 08:00-22:00
  - Менеджер: `999999000`

#### В BookingService фикстуры создадут:
- Конфигурации слотов (глобальные, для адресов, для услуг)
- Тестовые бронирования с разными статусами

---

## Тестовые сценарии

### 1. Получение свободных слотов (GET /api/v1/companies/{companyId}/addresses/{addressId}/available-slots)

**Публичный endpoint, авторизация не требуется**

#### TC-1.1: Получение слотов на завтрашний день (обычный сценарий)
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: завтра
- **Ожидаемый результат**: 200 OK
  - Список слотов с 09:00 до 21:00 (шаг 30 мин по дефолту)
  - Каждый слот содержит `availableSpots` и `totalSpots`
  - Слоты в прошлом (до текущего времени + minBookingNoticeMinutes) не включены
- **Проверки**:
  - Слоты генерируются от начала рабочего дня с фиксированным шагом
  - Учитывается конфигурация для адреса 100 (maxConcurrentBookings = 4)
  - Слоты, где есть бронирования, показывают уменьшенный `availableSpots`

#### TC-1.2: Получение слотов на сегодня (учёт minBookingNoticeMinutes)
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: сегодня
- **Ожидаемый результат**: 200 OK
  - Слоты начинаются с (текущее время + minBookingNoticeMinutes)
  - Например, если сейчас 14:00 и minBookingNoticeMinutes=60, первый слот будет 15:00 или позже

#### TC-1.3: Получение слотов в выходной день
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: ближайшее воскресенье
- **Ожидаемый результат**: 200 OK
  - Пустой массив слотов (воскресенье выходной)

#### TC-1.4: Получение слотов для услуги с индивидуальной конфигурацией
- **Компания**: 1, **Адрес**: 100, **Услуга**: 2
- **Дата**: завтра
- **Ожидаемый результат**: 200 OK
  - Слоты с учётом специфичной конфигурации услуги (если есть)
  - `totalSpots` соответствует конфигурации для этой услуги

#### TC-1.5: Слоты полностью заняты
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: день с максимальным количеством бронирований
- **Ожидаемый результат**: 200 OK
  - Слоты присутствуют, но `availableSpots = 0` для занятых интервалов

#### TC-1.6: Несуществующая компания
- **Компания**: 99999, **Адрес**: 100, **Услуга**: 1
- **Ожидаемый результат**: 404 Not Found
  - `{"message": "company not found"}`

#### TC-1.7: Адрес не принадлежит компании
- **Компания**: 1, **Адрес**: 999, **Услуга**: 1
- **Ожидаемый результат**: 404 Not Found
  - `{"message": "address not found"}`

#### TC-1.8: Услуга не доступна на этом адресе
- **Компания**: 1, **Адрес**: 100, **Услуга**: 3
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "service not available at this address"}`
  - (Услуга 3 доступна только на адресе 101)

#### TC-1.9: Невалидная дата
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: "invalid-date"
- **Ожидаемый результат**: 400 Bad Request

#### TC-1.10: Дата в прошлом
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: вчера
- **Ожидаемый результат**: 200 OK
  - Пустой массив слотов (нельзя бронировать в прошлом)

---

### 2. Создание бронирования (POST /api/v1/bookings)

**Требуется userId в body**

#### TC-2.1: Успешное создание бронирования
- **Пользователь**: 123456789
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: завтра, **Время**: 10:00
- **Ожидаемый результат**: 201 Created
  - Возвращается созданное бронирование с ID
  - `status = "confirmed"`
  - Денормализованные данные (serviceName, servicePrice, carBrand, carModel, carLicensePlate)
  - `addressId = 100`

#### TC-2.2: Создание с notes
- **Пользователь**: 123456789
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: послезавтра, **Время**: 14:00
- **Notes**: "Пожалуйста, уделите внимание дискам"
- **Ожидаемый результат**: 201 Created
  - `notes` сохранены в бронировании

#### TC-2.3: Параллельное бронирование (2 бокса свободно)
- **Пользователь**: 987654321
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: завтра, **Время**: 10:00 (тот же слот, что в TC-2.1)
- **Ожидаемый результат**: 201 Created
  - Бронирование создано (maxConcurrentBookings не превышен)

#### TC-2.4: Слот полностью занят
- Предварительно создать maxConcurrentBookings бронирований на один слот
- **Пользователь**: 111222333
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: завтра, **Время**: 10:00
- **Ожидаемый результат**: 409 Conflict
  - `{"message": "slot not available"}`

#### TC-2.5: Бронирование слишком близко (нарушение minBookingNoticeMinutes)
- **Пользователь**: 123456789
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: сегодня, **Время**: через 30 минут (при minBookingNoticeMinutes=60)
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "booking is too soon"}`

#### TC-2.6: Бронирование слишком далеко (нарушение advanceBookingDays)
- **Компания с advanceBookingDays=30**
- **Дата**: через 40 дней
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "booking is too far in advance"}`

#### TC-2.7: Пользователь без выбранного автомобиля
- **Пользователь**: 999999999 (без выбранного авто)
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: завтра, **Время**: 15:00
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "no selected car"}`

#### TC-2.8: Несуществующая компания
- **Пользователь**: 123456789
- **Компания**: 99999, **Адрес**: 100, **Услуга**: 1
- **Ожидаемый результат**: 404 Not Found
  - `{"message": "company not found"}`

#### TC-2.9: Адрес не принадлежит компании
- **Пользователь**: 123456789
- **Компания**: 1, **Адрес**: 999, **Услуга**: 1
- **Ожидаемый результат**: 404 Not Found
  - `{"message": "address not found"}`

#### TC-2.10: Услуга не доступна на этом адресе
- **Пользователь**: 123456789
- **Компания**: 1, **Адрес**: 100, **Услуга**: 3
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "service not available at this address"}`

#### TC-2.11: Бронирование в выходной день
- **Пользователь**: 123456789
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: воскресенье, **Время**: 12:00
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "company is closed on this day"}`

#### TC-2.12: Бронирование вне рабочих часов
- **Пользователь**: 123456789
- **Компания**: 1, **Адрес**: 100, **Услуга**: 1
- **Дата**: завтра, **Время**: 22:00 (после 21:00)
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "time outside working hours"}`

#### TC-2.13: Невалидные данные (пустой userId)
- **Пользователь**: 0
- **Ожидаемый результат**: 400 Bad Request

#### TC-2.14: Невалидный формат даты
- **Дата**: "2025-13-45"
- **Ожидаемый результат**: 400 Bad Request

#### TC-2.15: Невалидный формат времени
- **Время**: "25:99"
- **Ожидаемый результат**: 400 Bad Request

---

### 3. Получение бронирования (GET /api/v1/bookings/{id})

**Требуется X-User-ID header**

#### TC-3.1: Получение своего бронирования (владелец)
- **Booking ID**: ID бронирования пользователя 123456789
- **X-User-ID**: 123456789
- **Ожидаемый результат**: 200 OK
  - Полная информация о бронировании
  - Все денормализованные данные присутствуют

#### TC-3.2: Получение чужого бронирования (не владелец, не менеджер)
- **Booking ID**: ID бронирования пользователя 123456789
- **X-User-ID**: 999999999
- **Ожидаемый результат**: 403 Forbidden
  - `{"message": "access denied"}`

#### TC-3.3: Получение бронирования менеджером компании
- **Booking ID**: ID бронирования в компании 1
- **X-User-ID**: 777777777 (менеджер компании 1)
- **Ожидаемый результат**: 200 OK
  - Менеджер может видеть бронирования своей компании

#### TC-3.4: Несуществующее бронирование
- **Booking ID**: 999999
- **X-User-ID**: 123456789
- **Ожидаемый результат**: 404 Not Found
  - `{"message": "booking not found"}`

#### TC-3.5: Без заголовка X-User-ID
- **Booking ID**: существующий ID
- **X-User-ID**: отсутствует
- **Ожидаемый результат**: 401 Unauthorized
  - `{"message": "missing user ID"}`

#### TC-3.6: Невалидный booking ID (не число)
- **Booking ID**: "abc"
- **Ожидаемый результат**: 400 Bad Request

---

### 4. Отмена бронирования (PATCH /api/v1/bookings/{id}/cancel)

**Требуется userId в body**

#### TC-4.1: Успешная отмена своего бронирования
- **Booking ID**: активное бронирование пользователя 123456789
- **User ID**: 123456789
- **Reason**: "Изменились планы"
- **Ожидаемый результат**: 200 OK
  - `status = "cancelled_by_user"`
  - `cancellationReason` сохранена
  - `cancelledAt` установлена

#### TC-4.2: Отмена без указания причины
- **Booking ID**: активное бронирование пользователя 123456789
- **User ID**: 123456789
- **Reason**: null
- **Ожидаемый результат**: 200 OK
  - Отмена прошла успешно, `cancellationReason = null`

#### TC-4.3: Попытка отменить чужое бронирование
- **Booking ID**: бронирование пользователя 123456789
- **User ID**: 999999999
- **Ожидаемый результат**: 403 Forbidden
  - `{"message": "access denied"}`

#### TC-4.4: Отмена менеджером компании
- **Booking ID**: бронирование в компании 1
- **User ID**: 777777777 (менеджер компании 1)
- **Reason**: "Технические работы"
- **Ожидаемый результат**: 200 OK
  - `status = "cancelled_by_company"`
  - Менеджер может отменять бронирования в своей компании

#### TC-4.5: Повторная отмена уже отменённого бронирования
- **Booking ID**: уже отменённое бронирование
- **User ID**: владелец
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "booking already inactive"}`

#### TC-4.6: Отмена выполненного бронирования
- **Booking ID**: бронирование со статусом "completed"
- **User ID**: владелец
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "booking already inactive"}`

#### TC-4.7: Несуществующее бронирование
- **Booking ID**: 999999
- **User ID**: 123456789
- **Ожидаемый результат**: 404 Not Found

---

### 5. История бронирований пользователя (GET /api/v1/users/{userId}/bookings)

**Требуется X-User-ID header**

#### TC-5.1: Получение всех бронирований пользователя
- **User ID в URL**: 123456789
- **X-User-ID**: 123456789
- **Ожидаемый результат**: 200 OK
  - Массив всех бронирований пользователя
  - Включены все статусы (confirmed, completed, cancelled и т.д.)
  - Отсортированы по дате (новые первыми)

#### TC-5.2: Фильтрация по статусу "confirmed"
- **User ID в URL**: 123456789
- **X-User-ID**: 123456789
- **Query**: ?status=confirmed
- **Ожидаемый результат**: 200 OK
  - Только активные подтверждённые бронирования

#### TC-5.3: Фильтрация по статусу "completed"
- **User ID в URL**: 123456789
- **X-User-ID**: 123456789
- **Query**: ?status=completed
- **Ожидаемый результат**: 200 OK
  - Только выполненные бронирования

#### TC-5.4: Попытка получить чужую историю
- **User ID в URL**: 123456789
- **X-User-ID**: 999999999
- **Ожидаемый результат**: 403 Forbidden
  - `{"message": "access denied"}`

#### TC-5.5: Пустая история (нет бронирований)
- **User ID в URL**: 555555555 (пользователь без бронирований)
- **X-User-ID**: 555555555
- **Ожидаемый результат**: 200 OK
  - Пустой массив `[]`

#### TC-5.6: Без заголовка X-User-ID
- **User ID в URL**: 123456789
- **X-User-ID**: отсутствует
- **Ожидаемый результат**: 401 Unauthorized

---

### 6. Бронирования компании (GET /api/v1/companies/{companyId}/bookings)

**Требуется X-User-ID header (только для менеджеров компании или superuser)**

#### TC-6.1: Получение всех бронирований компании (менеджер)
- **Company ID**: 1
- **X-User-ID**: 777777777 (менеджер компании 1)
- **Ожидаемый результат**: 200 OK
  - Массив всех активных бронирований компании
  - По умолчанию не включает отменённые (includeInactive=false)

#### TC-6.2: Фильтрация по адресу
- **Company ID**: 1
- **X-User-ID**: 777777777
- **Query**: ?addressId=100
- **Ожидаемый результат**: 200 OK
  - Только бронирования на адресе 100

#### TC-6.3: Фильтрация по дате
- **Company ID**: 1
- **X-User-ID**: 777777777
- **Query**: ?date=2025-11-10
- **Ожидаемый результат**: 200 OK
  - Только бронирования на 10 ноября 2025

#### TC-6.4: Фильтрация по периоду
- **Company ID**: 1
- **X-User-ID**: 777777777
- **Query**: ?startDate=2025-11-01&endDate=2025-11-30
- **Ожидаемый результат**: 200 OK
  - Бронирования за ноябрь 2025

#### TC-6.5: Фильтрация по статусу
- **Company ID**: 1
- **X-User-ID**: 777777777
- **Query**: ?status=confirmed
- **Ожидаемый результат**: 200 OK
  - Только подтверждённые бронирования

#### TC-6.6: Включение отменённых бронирований
- **Company ID**: 1
- **X-User-ID**: 777777777
- **Query**: ?includeInactive=true
- **Ожидаемый результат**: 200 OK
  - Все бронирования, включая cancelled, no_show

#### TC-6.7: Попытка доступа не-менеджером
- **Company ID**: 1
- **X-User-ID**: 999999999 (не менеджер)
- **Ожидаемый результат**: 403 Forbidden
  - `{"message": "access denied"}`

#### TC-6.8: Несуществующая компания
- **Company ID**: 99999
- **X-User-ID**: 777777777
- **Ожидаемый результат**: 404 Not Found

#### TC-6.9: Комбинированные фильтры
- **Company ID**: 1
- **X-User-ID**: 777777777
- **Query**: ?addressId=100&date=2025-11-10&status=confirmed
- **Ожидаемый результат**: 200 OK
  - Подтверждённые бронирования на адресе 100 на 10 ноября

---

### 7. Получение конфигурации компании (GET /api/v1/companies/{companyId}/config)

**Публичный endpoint**

#### TC-7.1: Глобальная конфигурация компании
- **Company ID**: 1
- **Query**: (без параметров)
- **Ожидаемый результат**: 200 OK
  - Возвращается глобальная конфигурация (companyId, addressId=null, serviceId=null)
  - Все параметры: slotDurationMinutes, maxConcurrentBookings, advanceBookingDays, minBookingNoticeMinutes

#### TC-7.2: Конфигурация для конкретного адреса
- **Company ID**: 1
- **Query**: ?addressId=100
- **Ожидаемый результат**: 200 OK
  - Возвращается конфигурация для адреса 100
  - Приоритет: (1, 100, null) > (1, null, null)

#### TC-7.3: Конфигурация для конкретной услуги на адресе
- **Company ID**: 1
- **Query**: ?addressId=100&serviceId=2
- **Ожидаемый результат**: 200 OK
  - Возвращается наиболее специфичная конфигурация
  - Приоритет: (1, 100, 2) > (1, 100, null) > (1, null, 2) > (1, null, null)

#### TC-7.4: Конфигурация для услуги (без адреса)
- **Company ID**: 1
- **Query**: ?serviceId=2
- **Ожидаемый результат**: 200 OK
  - Возвращается конфигурация для услуги 2
  - Приоритет: (1, null, 2) > (1, null, null)

#### TC-7.5: Дефолтная конфигурация (нет в БД)
- **Company ID**: 999 (компания без конфигурации)
- **Ожидаемый результат**: 200 OK
  - Возвращаются дефолтные значения из приложения
  - slotDurationMinutes=30, maxConcurrentBookings=1, advanceBookingDays=0, minBookingNoticeMinutes=60

#### TC-7.6: Несуществующая компания
- **Company ID**: 99999
- **Ожидаемый результат**: 404 Not Found

---

### 8. Обновление конфигурации компании (PUT /api/v1/companies/{companyId}/config)

**Требуется userId в body (только менеджер компании)**

#### TC-8.1: Обновление глобальной конфигурации менеджером
- **Company ID**: 1
- **User ID**: 777777777 (менеджер)
- **Body**:
  ```json
  {
    "userId": 777777777,
    "slotDurationMinutes": 60,
    "maxConcurrentBookings": 5,
    "advanceBookingDays": 0,
    "minBookingNoticeMinutes": 120
  }
  ```
- **Ожидаемый результат**: 200 OK
  - Конфигурация обновлена
  - Возвращается обновлённая конфигурация

#### TC-8.2: Создание конфигурации для адреса
- **Company ID**: 1
- **User ID**: 777777777
- **Body**:
  ```json
  {
    "userId": 777777777,
    "addressId": 100,
    "slotDurationMinutes": 30,
    "maxConcurrentBookings": 4
  }
  ```
- **Ожидаемый результат**: 200 OK
  - Создана/обновлена конфигурация для адреса 100

#### TC-8.3: Создание конфигурации для услуги на адресе
- **Company ID**: 1
- **User ID**: 777777777
- **Body**:
  ```json
  {
    "userId": 777777777,
    "addressId": 100,
    "serviceId": 2,
    "maxConcurrentBookings": 2
  }
  ```
- **Ожидаемый результат**: 200 OK
  - Создана наиболее специфичная конфигурация

#### TC-8.4: Попытка обновления не-менеджером
- **Company ID**: 1
- **User ID**: 999999999 (не менеджер)
- **Ожидаемый результат**: 403 Forbidden
  - `{"message": "access denied"}`

#### TC-8.5: Невалидные значения (отрицательные числа)
- **Company ID**: 1
- **User ID**: 777777777
- **Body**:
  ```json
  {
    "userId": 777777777,
    "slotDurationMinutes": -10
  }
  ```
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "invalid slot duration"}`

#### TC-8.6: Невалидный адрес (не принадлежит компании)
- **Company ID**: 1
- **User ID**: 777777777
- **Body**:
  ```json
  {
    "userId": 777777777,
    "addressId": 999
  }
  ```
- **Ожидаемый результат**: 400 Bad Request
  - `{"message": "address not found"}`

#### TC-8.7: Несуществующая компания
- **Company ID**: 99999
- **User ID**: 777777777
- **Ожидаемый результат**: 404 Not Found

---

## Тестирование граничных случаев

### Временные пересечения (overlapping bookings)

#### TC-Edge-1: Граничные слоты не считаются пересечением
- Бронирование A: 10:00-11:00
- Бронирование B: 11:00-12:00
- **Ожидаемый результат**: Оба могут существовать одновременно (не считается пересечением)

#### TC-Edge-2: Частичное пересечение
- Бронирование A: 10:00-11:00
- Попытка создать B: 10:30-11:30
- **Ожидаемый результат**:
  - Если `availableSpots > 0` → 201 Created
  - Если `availableSpots = 0` → 409 Conflict

#### TC-Edge-3: Полное перекрытие
- Бронирование A: 10:00-12:00
- Попытка создать B: 10:30-11:00
- **Ожидаемый результат**: Аналогично TC-Edge-2

### Конкурентное создание бронирований (race condition)

#### TC-Race-1: Одновременные запросы на последний свободный слот
- Параллельно отправить 2 запроса на создание бронирования в один слот
- В слоте остаётся только 1 свободное место
- **Ожидаемый результат**:
  - Один запрос: 201 Created
  - Второй запрос: 409 Conflict
  - В БД создано ровно 1 бронирование (транзакция Serializable)

### Работа с временными зонами

#### TC-TZ-1: Время на границе дня
- **Дата**: 2025-11-10
- **Время**: 23:30
- **Услуга**: длительность 60 минут
- **Ожидаемый результат**: Бронирование создано, end_time корректно вычислено

---

## Метрики и мониторинг

### Prometheus метрики (GET /metrics)

#### TC-Metrics-1: Доступность endpoint
- **URL**: http://localhost:8083/metrics
- **Ожидаемый результат**: 200 OK
  - Возвращаются метрики в формате Prometheus

#### TC-Metrics-2: HTTP метрики
- **Проверить наличие**:
  - `http_requests_total` - счётчик запросов
  - `http_request_duration_seconds` - длительность запросов
  - `http_errors_total` - счётчик ошибок

#### TC-Metrics-3: Database метрики
- **Проверить наличие**:
  - `db_queries_total` - счётчик запросов к БД
  - `db_query_duration_seconds` - длительность запросов
  - `db_connections_*` - статистика пула соединений

---

## Порядок выполнения тестов

### Этап 1: Подготовка окружения
1. Запустить все сервисы (BookingService, UserService, SellerService, PostgreSQL)
2. Применить миграции: `make db-reset`
3. Загрузить фикстуры: `make fixtures`
4. Создать тестовые данные в UserService и SellerService

### Этап 2: Smoke тесты
1. TC-1.1 - Получение слотов
2. TC-2.1 - Создание бронирования
3. TC-3.1 - Получение бронирования
4. TC-Metrics-1 - Проверка метрик

### Этап 3: Позитивные сценарии
- Все TC-X.1, TC-X.2, TC-X.3 (основные success сценарии)

### Этап 4: Негативные сценарии
- Все TC с ожидаемым результатом 400, 403, 404, 409

### Этап 5: Граничные случаи
- TC-Edge-* - временные пересечения
- TC-Race-* - конкурентные запросы
- TC-TZ-* - временные зоны

### Этап 6: Нагрузочное тестирование (опционально)
- 100 параллельных запросов на получение слотов
- 50 одновременных попыток создать бронирование в один слот

---

## Критерии успешности

### Обязательные требования
- ✅ Все smoke тесты проходят
- ✅ Все позитивные сценарии возвращают корректные данные
- ✅ Все негативные сценарии возвращают правильные коды ошибок
- ✅ Денормализованные данные корректно сохраняются
- ✅ Поддержка адресов работает корректно
- ✅ Иерархия конфигурации применяется правильно
- ✅ Транзакции предотвращают race conditions

### Дополнительные требования
- ✅ Метрики доступны и корректны
- ✅ Логи не содержат ERROR уровня (кроме ожидаемых ошибок)
- ✅ Время ответа < 200ms для GET запросов
- ✅ Время ответа < 500ms для POST/PUT запросов

---

## Инструменты для тестирования

### cURL
- Команды в `test_data/api_requests.sh`

### HTTP-клиенты
- JetBrains HTTP Client (`.http` файлы в `test_data/`)
- Postman collection (опционально)

### Автоматизация
- Bash-скрипт для запуска всех тестов: `test_data/run_tests.sh`
- Вывод результатов в формате: `PASS` / `FAIL` с описанием

---

## Отчётность

После выполнения тестов создать отчёт:

### test_data/TEST_RESULTS.md
```markdown
# Test Results - BookingService

**Дата**: 2025-11-05
**Версия**: v1.0.0
**Окружение**: Local Development

## Сводка
- Всего тестов: 80
- Пройдено: 78
- Не пройдено: 2
- Пропущено: 0

## Детали

### Пройденные тесты
- ✅ TC-1.1: Получение слотов на завтрашний день
- ✅ TC-2.1: Успешное создание бронирования
...

### Не пройденные тесты
- ❌ TC-2.4: Слот полностью занят
  - **Ожидалось**: 409 Conflict
  - **Получено**: 201 Created
  - **Причина**: Не учитывается maxConcurrentBookings

### Баги
1. **Bug-001**: Параллельные бронирования не работают корректно
   - **Серьёзность**: High
   - **Шаги**: TC-2.4
   ...
```

---

## Следующие шаги

После успешного прохождения тестов:
1. Задокументировать найденные баги
2. Исправить критичные проблемы
3. Повторить тестирование
4. Подготовить сервис к деплою
